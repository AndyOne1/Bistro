<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bistro Kasse</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // Icons (simple SVG components)
    const Settings = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path>
      </svg>
    );

    const Calendar = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    );

    const X = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const Plus = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Trash2 = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      </svg>
    );

    const Undo = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M3 7v6h6"></path>
        <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
      </svg>
    );

    const Pencil = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M12 20h9"></path>
        <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
      </svg>
    );

    const Check = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M20 6L9 17l-5-5"></path>
      </svg>
    );

    // Domain constants
    const CATEGORIES = ["Getränke", "Snacks", "Eis"];

    // Central styling map (category colors)
    const CATEGORY_STYLES = {
      Getränke: {
        button: "bg-blue-500 hover:bg-blue-600",
        badge: "bg-blue-50 text-blue-700 border-blue-200",
      },
      Snacks: {
        button: "bg-amber-500 hover:bg-amber-600",
        badge: "bg-amber-50 text-amber-800 border-amber-200",
      },
      Eis: {
        button: "bg-fuchsia-500 hover:bg-fuchsia-600",
        badge: "bg-fuchsia-50 text-fuchsia-800 border-fuchsia-200",
      },
    };

    // Helpers
    const newId = () =>
      (crypto && crypto.randomUUID) ? crypto.randomUUID() : `${Date.now()}-${Math.random().toString(16).slice(2)}`;

    const asMoney = (n) => (Number(n) || 0).toFixed(2);

    const BistroKasse = () => {
      const [articles, setArticles] = useState([]);
      const [currentTransaction, setCurrentTransaction] = useState([]);

      const [showSettings, setShowSettings] = useState(false);
      const [showPayment, setShowPayment] = useState(false);
      const [showDayReport, setShowDayReport] = useState(false);

      const [givenAmount, setGivenAmount] = useState(0);

      // dailySales keyed by item id
      // shape: { [id]: { id, name, count, revenue } }
      const [dailySales, setDailySales] = useState({});
      const [savedDays, setSavedDays] = useState([]);

      const [newArticle, setNewArticle] = useState({ name: "", price: "", category: "Getränke" });

      // Editing state
      const [editingId, setEditingId] = useState(null);
      const [editDraft, setEditDraft] = useState({ name: "", price: "", category: "Getränke" });

      useEffect(() => {
        const savedArticles = localStorage.getItem("bistro-articles");
        const savedDailySales = localStorage.getItem("bistro-daily-sales");
        const savedDaysData = localStorage.getItem("bistro-saved-days");

        if (savedArticles) {
          const parsed = JSON.parse(savedArticles);
          const migrated = Array.isArray(parsed)
            ? parsed.map((a) => ({
                id: a.id || newId(),
                name: a.name || "",
                price: typeof a.price === "number" ? a.price : parseFloat(a.price),
                category: a.category && CATEGORIES.includes(a.category) ? a.category : "Getränke",
              })).filter((a) => a.name && !Number.isNaN(a.price))
            : [];
          setArticles(migrated);
        }

        if (savedDailySales) {
          const parsed = JSON.parse(savedDailySales);
          // Backward-compatible migration: if keyed by name, convert best-effort
          if (parsed && !Array.isArray(parsed) && typeof parsed === "object") {
            const values = Object.values(parsed);
            const looksLikeOld = values.length && values[0] && values[0].count !== undefined && values[0].revenue !== undefined && !values[0].id;
            if (looksLikeOld) {
              const converted = {};
              Object.entries(parsed).forEach(([name, data]) => {
                const id = `legacy-${name}`;
                converted[id] = { id, name, count: data.count || 0, revenue: data.revenue || 0 };
              });
              setDailySales(converted);
            } else {
              setDailySales(parsed);
            }
          }
        }

        if (savedDaysData) setSavedDays(JSON.parse(savedDaysData));
      }, []);

      useEffect(() => {
        localStorage.setItem("bistro-articles", JSON.stringify(articles));
      }, [articles]);

      useEffect(() => {
        localStorage.setItem("bistro-daily-sales", JSON.stringify(dailySales));
      }, [dailySales]);

      useEffect(() => {
        localStorage.setItem("bistro-saved-days", JSON.stringify(savedDays));
      }, [savedDays]);

      const pfandInItem = useMemo(() => ({ id: "pfand_in", name: "Pfand Einnahme", price: 0.25, category: "Pfand" }), []);
      const pfandOutItem = useMemo(() => ({ id: "pfand_out", name: "Pfand Ausgabe", price: -0.25, category: "Pfand" }), []);

      const categorizedArticles = useMemo(() => {
        const grouped = CATEGORIES.reduce((acc, cat) => (acc[cat] = [], acc), {});
        for (const a of articles) {
          const cat = (a.category && CATEGORIES.includes(a.category)) ? a.category : "Getränke";
          grouped[cat].push(a);
        }
        return grouped;
      }, [articles]);

      const addToTransaction = (item) => {
        setCurrentTransaction((prev) => [...prev, item]);

        setDailySales((prev) => {
          const next = { ...prev };
          const key = item.id || `legacy-${item.name}`;
          if (!next[key]) next[key] = { id: key, name: item.name, count: 0, revenue: 0 };

          next[key].name = item.name;
          next[key].count += 1;
          next[key].revenue += item.price;
          return next;
        });
      };

      const undoLastItem = () => {
        setCurrentTransaction((prev) => {
          if (prev.length === 0) return prev;
          const last = prev[prev.length - 1];

          setDailySales((salesPrev) => {
            const next = { ...salesPrev };
            const key = last.id || `legacy-${last.name}`;
            if (next[key]) {
              next[key].count -= 1;
              next[key].revenue -= last.price;
              if (next[key].count <= 0) delete next[key];
            }
            return next;
          });

          return prev.slice(0, -1);
        });
      };

      const calculateTotal = () => currentTransaction.reduce((sum, item) => sum + item.price, 0);

      const handleAddArticle = () => {
        if (!newArticle.name || !newArticle.price) return;
        const price = parseFloat(newArticle.price);
        if (Number.isNaN(price)) return;

        const category = CATEGORIES.includes(newArticle.category) ? newArticle.category : "Getränke";
        const article = { id: newId(), name: newArticle.name, price, category };

        setArticles((prev) => [...prev, article]);
        setNewArticle({ name: "", price: "", category: "Getränke" });
      };

      const handleDeleteArticle = (id) => {
        setArticles((prev) => prev.filter((a) => a.id !== id));
      };

      const startEdit = (article) => {
        setEditingId(article.id);
        setEditDraft({ name: article.name, price: String(article.price), category: article.category || "Getränke" });
      };

      const cancelEdit = () => {
        setEditingId(null);
        setEditDraft({ name: "", price: "", category: "Getränke" });
      };

      const saveEdit = () => {
        if (!editingId) return;
        if (!editDraft.name || !editDraft.price) return;

        const price = parseFloat(editDraft.price);
        if (Number.isNaN(price)) return;

        const category = CATEGORIES.includes(editDraft.category) ? editDraft.category : "Getränke";

        setArticles((prev) =>
          prev.map((a) =>
            a.id === editingId
              ? { ...a, name: editDraft.name, price, category }
              : a
          )
        );

        cancelEdit();
      };

      const addToGivenAmount = (amount) => setGivenAmount((prev) => prev + amount);
      const calculateChange = () => givenAmount - calculateTotal();

      const completeTransaction = () => {
        setCurrentTransaction([]);
        setGivenAmount(0);
        setShowPayment(false);
      };

      const getDayStats = () => {
        let pfandIn = 0;
        let pfandOut = 0;
        let merchandise = 0;

        Object.values(dailySales).forEach((data) => {
          if (data.id === "pfand_in" || data.name === "Pfand Einnahme") pfandIn += data.revenue;
          else if (data.id === "pfand_out" || data.name === "Pfand Ausgabe") pfandOut += data.revenue;
          else merchandise += data.revenue;
        });

        return {
          pfandIn,
          pfandOut,
          pfandBalance: pfandIn + pfandOut,
          merchandise,
          total: pfandIn + pfandOut + merchandise,
        };
      };

      const closeDay = () => {
        const today = new Date().toLocaleDateString("de-DE");
        const totalRevenue = Object.values(dailySales).reduce((sum, item) => sum + item.revenue, 0);

        const dayData = {
          date: today,
          sales: { ...dailySales },
          totalRevenue,
        };

        setSavedDays((prev) => [dayData, ...prev]);
        setDailySales({});
      };

      const deleteSavedDay = (index) => {
        const ok = window.confirm("Diesen Tag wirklich löschen?");
        if (!ok) return;
        setSavedDays((prev) => prev.filter((_, i) => i !== index));
      };

      // NEU: Leeren macht auch dailySales rückgängig (wie kompletter Undo)
      const clearTransaction = () => {
        if (currentTransaction.length === 0) return;

        setDailySales((salesPrev) => {
          const next = { ...salesPrev };

          for (const item of currentTransaction) {
            const key = item.id || `legacy-${item.name}`;
            if (!next[key]) continue;

            next[key].count -= 1;
            next[key].revenue -= item.price;

            if (next[key].count <= 0) delete next[key];
          }

          return next;
        });

        setCurrentTransaction([]);
        setGivenAmount(0);
      };

      const stats = getDayStats();

      // Fixed bottom panel sizing
      const bottomPanelHeightClass = "h-72";
      const bottomPaddingClass = "pb-80";

      return (
        <div className={`min-h-screen bg-gray-50 p-4 ${bottomPaddingClass}`}>
          <div className="max-w-7xl mx-auto mb-6">
            <div className="flex justify-between items-center">
              <h1 className="text-3xl font-bold text-gray-800">Bistro Kasse</h1>
              <div className="flex gap-2">
                <button
                  onClick={() => setShowDayReport(true)}
                  className="p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"
                  title="Tagesabschluss"
                >
                  <Calendar />
                </button>
                <button
                  onClick={() => setShowSettings(true)}
                  className="p-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition"
                  title="Einstellungen"
                >
                  <Settings />
                </button>
              </div>
            </div>
          </div>

          <div className="max-w-7xl mx-auto">
            <div className="bg-white rounded-lg shadow-md p-6">
              <h2 className="text-xl font-semibold mb-4 text-gray-700">Artikel</h2>

              {/* Pfand separat */}
              <div className="mb-6">
                <h3 className="text-sm font-bold uppercase tracking-wide text-gray-500 mb-2">Pfand</h3>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                  <button
                    onClick={() => addToTransaction(pfandInItem)}
                    className="p-4 bg-green-500 text-white rounded-lg hover:bg-green-600 transition font-semibold"
                  >
                    Pfand Einnahme<br />+0,25€
                  </button>
                  <button
                    onClick={() => addToTransaction(pfandOutItem)}
                    className="p-4 bg-red-500 text-white rounded-lg hover:bg-red-600 transition font-semibold"
                  >
                    Pfand Ausgabe<br />-0,25€
                  </button>
                </div>
              </div>

              {/* Kategorien */}
              <div className="space-y-6">
                {CATEGORIES.map((cat) => {
                  const styles = CATEGORY_STYLES[cat];
                  return (
                    <div key={cat}>
                      <div className="flex items-center justify-between mb-2">
                        <div className={`inline-flex items-center gap-2 px-3 py-1 rounded-full border text-sm font-semibold ${styles.badge}`}>
                          {cat}
                        </div>
                        <span className="text-xs text-gray-400">{categorizedArticles[cat].length} Artikel</span>
                      </div>

                      {categorizedArticles[cat].length === 0 ? (
                        <div className="p-4 bg-gray-50 rounded-lg text-gray-400 text-sm">
                          Keine Artikel in dieser Kategorie
                        </div>
                      ) : (
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                          {categorizedArticles[cat].map((article) => (
                            <button
                              key={article.id}
                              onClick={() => addToTransaction(article)}
                              className={`p-4 text-white rounded-lg transition font-semibold ${styles.button}`}
                            >
                              {article.name}<br />
                              {article.price > 0 ? "+" : ""}
                              {asMoney(article.price)}€
                            </button>
                          ))}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          </div>

          {/* Fixed bottom "Aktueller Vorgang" panel */}
          <div className="fixed left-0 right-0 bottom-0 z-40 p-3">
            <div className="max-w-7xl mx-auto">
              <div className={`bg-white rounded-xl shadow-2xl border ${bottomPanelHeightClass} overflow-hidden`}>
                <div className="h-full flex flex-col">
                  <div className="px-4 py-3 border-b flex items-center justify-between">
                    <h2 className="text-lg font-semibold text-gray-700">Aktueller Vorgang</h2>
                    <div className="flex items-center gap-2">
                      <button
                        onClick={undoLastItem}
                        disabled={currentTransaction.length === 0}
                        className="p-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed"
                        title="Letzten Eintrag rückgängig machen"
                      >
                        <Undo />
                      </button>
                      <button
                        onClick={clearTransaction}
                        disabled={currentTransaction.length === 0}
                        className="px-3 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
                        title="Vorgang leeren (inkl. Zählung rückgängig)"
                      >
                        Leeren
                      </button>
                    </div>
                  </div>

                  {/* Scrollable list */}
                  <div className="flex-1 overflow-y-auto px-4 py-2">
                    {currentTransaction.length === 0 ? (
                      <p className="text-gray-400 text-center py-8">Keine Artikel</p>
                    ) : (
                      currentTransaction.map((item, index) => (
                        <div key={`${item.id || item.name}-${index}`} className="flex justify-between py-2 border-b">
                          <span className="text-gray-700">{item.name}</span>
                          <span className={`font-semibold ${item.price >= 0 ? "text-green-600" : "text-red-600"}`}>
                            {item.price > 0 ? "+" : ""}
                            {asMoney(item.price)}€
                          </span>
                        </div>
                      ))
                    )}
                  </div>

                  {/* Total + Pay always visible */}
                  <div className="px-4 py-3 border-t bg-white">
                    <div className="flex items-center justify-between mb-3">
                      <span className="text-lg font-bold text-gray-800">Gesamt:</span>
                      <span className="text-2xl font-bold text-blue-600">{asMoney(calculateTotal())}€</span>
                    </div>

                    <button
                      onClick={() => setShowPayment(true)}
                      disabled={currentTransaction.length === 0}
                      className="w-full py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed"
                    >
                      Zur Bezahlung
                    </button>
                  </div>
                </div>
              </div>

              <p className="text-xs text-gray-400 mt-2 text-center">
                Hinweis: Der Vorgang bleibt unten sichtbar; die Artikelliste kann unabhängig gescrollt werden.
              </p>
            </div>
          </div>

          {/* Settings modal */}
          {showSettings && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto p-6">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-2xl font-bold text-gray-800">Einstellungen</h2>
                  <button onClick={() => setShowSettings(false)} className="text-gray-500 hover:text-gray-700">
                    <X />
                  </button>
                </div>

                <div className="mb-6">
                  <h3 className="text-lg font-semibold mb-3 text-gray-700">Neuer Artikel</h3>
                  <div className="flex flex-col md:flex-row gap-2">
                    <input
                      type="text"
                      placeholder="Name"
                      value={newArticle.name}
                      onChange={(e) => setNewArticle({ ...newArticle, name: e.target.value })}
                      className="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <input
                      type="number"
                      step="0.01"
                      placeholder="Preis (€)"
                      value={newArticle.price}
                      onChange={(e) => setNewArticle({ ...newArticle, price: e.target.value })}
                      className="w-full md:w-32 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <select
                      value={newArticle.category}
                      onChange={(e) => setNewArticle({ ...newArticle, category: e.target.value })}
                      className="w-full md:w-40 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"
                    >
                      {CATEGORIES.map((cat) => (
                        <option key={cat} value={cat}>{cat}</option>
                      ))}
                    </select>
                    <button
                      onClick={handleAddArticle}
                      className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
                      title="Artikel hinzufügen"
                    >
                      <Plus />
                    </button>
                  </div>
                </div>

                <div>
                  <h3 className="text-lg font-semibold mb-3 text-gray-700">Vorhandene Artikel</h3>
                  <div className="space-y-2">
                    {articles.map((article) => {
                      const isEditing = editingId === article.id;
                      const badge = CATEGORY_STYLES[article.category || "Getränke"]?.badge || "bg-gray-50 text-gray-700 border-gray-200";
                      return (
                        <div key={article.id} className="p-3 bg-gray-50 rounded-lg">
                          {!isEditing ? (
                            <div className="flex justify-between items-center gap-3">
                              <div className="min-w-0">
                                <div className="font-medium text-gray-700 truncate">{article.name}</div>
                                <div className="mt-1 flex items-center gap-2">
                                  <span className={`text-xs px-2 py-0.5 rounded-full border ${badge}`}>
                                    {article.category || "Getränke"}
                                  </span>
                                  <span className="text-blue-600 font-semibold">{asMoney(article.price)}€</span>
                                </div>
                              </div>
                              <div className="flex items-center gap-2">
                                <button
                                  onClick={() => startEdit(article)}
                                  className="px-3 py-2 bg-white border rounded-lg hover:bg-gray-100 transition"
                                  title="Bearbeiten"
                                >
                                  <Pencil />
                                </button>
                                <button
                                  onClick={() => handleDeleteArticle(article.id)}
                                  className="px-3 py-2 bg-white border rounded-lg hover:bg-red-50 text-red-600 transition"
                                  title="Löschen"
                                >
                                  <Trash2 />
                                </button>
                              </div>
                            </div>
                          ) : (
                            <div className="space-y-3">
                              <div className="grid grid-cols-1 md:grid-cols-3 gap-2">
                                <input
                                  type="text"
                                  value={editDraft.name}
                                  onChange={(e) => setEditDraft({ ...editDraft, name: e.target.value })}
                                  className="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <input
                                  type="number"
                                  step="0.01"
                                  value={editDraft.price}
                                  onChange={(e) => setEditDraft({ ...editDraft, price: e.target.value })}
                                  className="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <select
                                  value={editDraft.category}
                                  onChange={(e) => setEditDraft({ ...editDraft, category: e.target.value })}
                                  className="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"
                                >
                                  {CATEGORIES.map((cat) => (
                                    <option key={cat} value={cat}>{cat}</option>
                                  ))}
                                </select>
                              </div>

                              <div className="flex gap-2">
                                <button
                                  onClick={saveEdit}
                                  className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition inline-flex items-center gap-2"
                                >
                                  <Check /> Speichern
                                </button>
                                <button
                                  onClick={cancelEdit}
                                  className="px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition inline-flex items-center gap-2"
                                >
                                  <X /> Abbrechen
                                </button>
                              </div>
                            </div>
                          )}
                        </div>
                      );
                    })}

                    {articles.length === 0 && (
                      <p className="text-gray-400 text-center py-6">Noch keine Artikel angelegt</p>
                    )}
                  </div>
                </div>

                {/* HINWEIS-BOX ENTFERNT (rot markierter Text) */}
              </div>
            </div>
          )}

          {/* Payment modal */}
          {showPayment && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-lg max-w-md w-full p-6">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-2xl font-bold text-gray-800">Bezahlung</h2>
                  <button
                    onClick={() => { setShowPayment(false); setGivenAmount(0); }}
                    className="text-gray-500 hover:text-gray-700"
                  >
                    <X />
                  </button>
                </div>

                <div className="mb-6">
                  <div className="bg-gray-100 p-4 rounded-lg mb-4">
                    <p className="text-gray-600 text-sm">Zu bezahlen:</p>
                    <p className="text-3xl font-bold text-gray-800">{asMoney(calculateTotal())}€</p>
                  </div>

                  <div className="bg-blue-50 p-4 rounded-lg mb-4">
                    <p className="text-gray-600 text-sm">Gegeben:</p>
                    <p className="text-2xl font-bold text-blue-600">{asMoney(givenAmount)}€</p>
                  </div>

                  <div className={`p-4 rounded-lg mb-4 ${calculateChange() >= 0 ? "bg-green-50" : "bg-red-50"}`}>
                    <p className="text-gray-600 text-sm">Rückgeld:</p>
                    <p className={`text-2xl font-bold ${calculateChange() >= 0 ? "text-green-600" : "text-red-600"}`}>
                      {asMoney(calculateChange())}€
                    </p>
                  </div>
                </div>

                <div className="grid grid-cols-5 gap-2 mb-4">
                  {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((amount) => (
                    <button
                      key={amount}
                      onClick={() => addToGivenAmount(amount)}
                      className="p-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold transition"
                    >
                      {amount}€
                    </button>
                  ))}
                </div>

                <input
                  type="number"
                  step="0.01"
                  value={givenAmount}
                  onChange={(e) => setGivenAmount(parseFloat(e.target.value) || 0)}
                  placeholder="Oder Betrag eingeben..."
                  className="w-full px-4 py-3 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                />

                <div className="flex gap-2">
                  <button
                    onClick={() => setGivenAmount(0)}
                    className="flex-1 py-3 bg-gray-400 text-white rounded-lg font-semibold hover:bg-gray-500 transition"
                  >
                    Zurücksetzen
                  </button>
                  <button
                    onClick={completeTransaction}
                    disabled={calculateChange() < 0}
                    className="flex-1 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed"
                  >
                    Abschließen
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Day report modal */}
          {showDayReport && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-lg max-w-3xl w-full max-h-[80vh] overflow-y-auto p-6">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-2xl font-bold text-gray-800">Tagesabschluss</h2>
                  <button onClick={() => setShowDayReport(false)} className="text-gray-500 hover:text-gray-700">
                    <X />
                  </button>
                </div>

                <div className="mb-8 p-6 bg-blue-50 rounded-lg">
                  <h3 className="text-xl font-bold mb-4 text-gray-800">Heutiger Tag</h3>

                  <div className="mb-4">
                    <h4 className="font-semibold text-gray-700 mb-2">Verkaufte Artikel:</h4>
                    <div className="space-y-1">
                      {Object.values(dailySales).map((data) => (
                        <div key={data.id} className="flex justify-between text-gray-600">
                          <span>{data.name}:</span>
                          <span className="font-semibold">{data.count}x</span>
                        </div>
                      ))}
                      {Object.keys(dailySales).length === 0 && (
                        <p className="text-gray-400 text-center py-4">Noch keine Verkäufe heute</p>
                      )}
                    </div>
                  </div>

                  <div className="border-t pt-4 space-y-2">
                    <div className="flex justify-between">
                      <span className="text-gray-600">Pfand Einnahmen:</span>
                      <span className="font-semibold text-green-600">+{asMoney(stats.pfandIn)}€</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Pfand Ausgaben:</span>
                      <span className="font-semibold text-red-600">{asMoney(stats.pfandOut)}€</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Pfand Bilanz:</span>
                      <span className={`font-semibold ${stats.pfandBalance >= 0 ? "text-green-600" : "text-red-600"}`}>
                        {asMoney(stats.pfandBalance)}€
                      </span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Warenverkauf:</span>
                      <span className="font-semibold text-blue-600">{asMoney(stats.merchandise)}€</span>
                    </div>
                    <div className="flex justify-between pt-2 border-t-2">
                      <span className="text-xl font-bold text-gray-800">Gesamteinnahmen:</span>
                      <span className="text-2xl font-bold text-blue-600">{asMoney(stats.total)}€</span>
                    </div>
                  </div>

                  <button
                    onClick={closeDay}
                    disabled={Object.keys(dailySales).length === 0}
                    className="w-full mt-4 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed"
                  >
                    Tag abschließen
                  </button>
                </div>

                <div>
                  <h3 className="text-xl font-bold mb-4 text-gray-800">Vorherige Tage</h3>
                  {savedDays.length === 0 ? (
                    <p className="text-gray-400 text-center py-8">Noch keine abgeschlossenen Tage</p>
                  ) : (
                    <div className="space-y-4">
                      {savedDays.map((day, index) => (
                        <div key={index} className="p-4 bg-gray-50 rounded-lg">
                          <div className="flex justify-between items-center mb-3 gap-3">
                            <div>
                              <h4 className="font-bold text-gray-800">{day.date}</h4>
                              <div className="text-xs text-gray-500">Archiv-Eintrag #{savedDays.length - index}</div>
                            </div>

                            <div className="flex items-center gap-3">
                              <span className="text-lg font-bold text-blue-600">{asMoney(day.totalRevenue)}€</span>
                              <button
                                onClick={() => deleteSavedDay(index)}
                                className="px-3 py-2 bg-white border rounded-lg hover:bg-red-50 text-red-600 transition"
                                title="Diesen Tag löschen"
                              >
                                <Trash2 />
                              </button>
                            </div>
                          </div>

                          <div className="text-sm space-y-1">
                            {day.sales && Object.values(day.sales).map((data) => (
                              <div key={data.id || data.name} className="flex justify-between text-gray-600">
                                <span>{data.name}:</span>
                                <span>
                                  {data.count}x ({asMoney(data.revenue)}€)
                                </span>
                              </div>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>

              </div>
            </div>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<BistroKasse />);
  </script>
</body>
</html>
